import{U as T,r as s,u as A,o as U,n as S,p as k,f as L,V as $,s as P,b as M,a as O,k as p,S as W,C as z,N as H,O as J,l as V,e as X,j as e,x as Y,L as q,H as G,I as Q,P as Z,J as K,W as ee,X as te,Y as ne,B as ae}from"./main-DGCghGMi.js";import{p as se}from"./LexicalNestedComposer.prod-LIkWPcLW.js";const _=new Set;function le(o){if(!_.has(o))throw new Promise(g=>{const a=new Image;a.src=o,a.onload=()=>{_.add(o),g(null)}})}function oe({altText:o,className:g,imageRef:a,src:h,width:i,height:u,position:c}){return le(h),e.jsx("img",{className:g||void 0,src:h,alt:o,ref:a,"data-position":c,style:{display:"block",height:u,width:i},draggable:"false"})}function re({activeEditor:o,nodeKey:g,onClose:a}){const i=o.getEditorState().read(()=>L(g)),[u,c]=s.useState(i.getAltText()),[C,E]=s.useState(i.getShowCaption()),[b,x]=s.useState(i.getPosition()),j=d=>{E(d.target.checked)},r=d=>{x(d.target.value)},f=()=>{const d={altText:u,position:b,showCaption:C};i&&o.update(()=>{i.update(d)}),a()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"1em"},children:e.jsx(ee,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:c,value:u,"data-test-id":"image-modal-alt-text-input"})}),e.jsxs(te,{style:{marginBottom:"1em",width:"208px"},value:b,label:"Position",name:"position",id:"position-select",onChange:r,children:[e.jsx("option",{value:"left",children:"Left"}),e.jsx("option",{value:"right",children:"Right"}),e.jsx("option",{value:"full",children:"Full Width"})]}),e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("input",{id:"caption",type:"checkbox",checked:C,onChange:j}),e.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),e.jsx(ne,{children:e.jsx(ae,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>f(),children:"Confirm"})})]})}function ue({src:o,altText:g,nodeKey:a,width:h,height:i,showCaption:u,caption:c,position:C}){const[E,b]=T(),x=s.useRef(null),j=s.useRef(null),[r,f,d]=A(a),[n]=U(),[N,y]=s.useState(null),w=s.useRef(null),I=s.useCallback(l=>{if(r&&S(k())){l.preventDefault();const t=L(a);if($(t))return t.remove(),!0}return!1},[r,a]),R=s.useCallback(l=>{const m=k(),t=j.current;if(r&&S(m)&&m.getNodes().length===1){if(u)return P(null),l.preventDefault(),c.focus(),!0;if(t!==null&&t!==document.activeElement)return l.preventDefault(),t.focus(),!0}return!1},[c,r,u]),D=s.useCallback(l=>w.current===c||j.current===l.target?(P(null),n.update(()=>{f(!0);const m=n.getRootElement();m!==null&&m.focus()}),!0):!1,[c,n,f]);s.useEffect(()=>{let l=!0;const m=M(n.registerUpdateListener(({editorState:t})=>{l&&y(t.read(()=>k()))}),n.registerCommand(X,(t,v)=>(w.current=v,!1),p),n.registerCommand(V,t=>{const v=t;return v.target===x.current?(v.shiftKey?f(!r):(d(),f(!0)),!0):!1},p),n.registerCommand(J,t=>t.target===x.current?(t.preventDefault(),!0):!1,p),n.registerCommand(H,I,p),n.registerCommand(z,I,p),n.registerCommand(W,R,p),n.registerCommand(O,D,p));return()=>{l=!1,m()}},[d,n,r,a,I,R,D,f]);const B=r&&S(N),F=r;return e.jsxs(s.Suspense,{fallback:null,children:[e.jsxs(e.Fragment,{children:[e.jsxs("div",{draggable:B,children:[e.jsx("button",{className:"image-edit-button",ref:j,onClick:()=>{b("Update Inline Image",l=>e.jsx(re,{activeEditor:n,nodeKey:a,onClose:l}))},children:"Edit"}),e.jsx(oe,{className:F?`focused ${S(N)?"draggable":""}`:null,src:o,altText:g,imageRef:x,width:h,height:i,position:C})]}),u&&e.jsx("div",{className:"image-caption-container",children:e.jsxs(se,{initialEditor:c,children:[e.jsx(Y,{}),e.jsx(q,{}),e.jsx(G,{contentEditable:e.jsx(Q,{className:"InlineImageNode__contentEditable"}),placeholder:e.jsx(Z,{className:"InlineImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:K})]})})]}),E]})}export{re as UpdateInlineImageDialog,ue as default};
