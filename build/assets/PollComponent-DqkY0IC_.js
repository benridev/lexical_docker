import{o as O,r as p,u as S,n as g,p as j,f as P,Z as k,b as I,C as D,k as v,N as E,l as R,j as t,B as V,m as $,a0 as b,a1 as y}from"./main-DGCghGMi.js";function A(s){return s.reduce((a,o)=>a+o.votes.length,0)}function B({option:s,index:a,options:o,totalVotes:r,withPollNode:x}){const{clientID:i}=$(),_=p.useRef(null),m=s.votes,f=m.indexOf(i)!==-1,d=m.length,h=s.text;return t.jsxs("div",{className:"PollNode__optionContainer",children:[t.jsx("div",{className:b("PollNode__optionCheckboxWrapper",f&&"PollNode__optionCheckboxChecked"),children:t.jsx("input",{ref:_,className:"PollNode__optionCheckbox",type:"checkbox",onChange:u=>{x(n=>{n.toggleVote(s,i)})},checked:f})}),t.jsxs("div",{className:"PollNode__optionInputWrapper",children:[t.jsx("div",{className:"PollNode__optionInputVotes",style:{width:`${d===0?0:d/r*100}%`}}),t.jsx("span",{className:"PollNode__optionInputVotesCount",children:d>0&&(d===1?"1 vote":`${d} votes`)}),t.jsx("input",{className:"PollNode__optionInput",type:"text",value:h,onChange:u=>{const n=u.target,N=n.value,e=n.selectionStart,l=n.selectionEnd;x(c=>{c.setOptionText(s,N)},()=>{n.selectionStart=e,n.selectionEnd=l})},placeholder:`Option ${a+1}`})]}),t.jsx("button",{disabled:o.length<3,className:b("PollNode__optionDelete",o.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{x(u=>{u.deleteOption(s)})}})]})}function W({question:s,options:a,nodeKey:o}){const[r]=O(),x=p.useMemo(()=>A(a),[a]),[i,_,m]=S(o),[C,f]=p.useState(null),d=p.useRef(null),h=p.useCallback(e=>{if(i&&g(j())){e.preventDefault();const c=P(o);if(k(c))return c.remove(),!0}return!1},[i,o]);p.useEffect(()=>I(r.registerUpdateListener(({editorState:e})=>{f(e.read(()=>j()))}),r.registerCommand(R,e=>{const l=e;return l.target===d.current?(l.shiftKey||m(),_(!i),!0):!1},v),r.registerCommand(E,h,v),r.registerCommand(D,h,v)),[m,r,i,o,h,_]);const u=(e,l)=>{r.update(()=>{const c=P(o);k(c)&&e(c)},{onUpdate:l})},n=()=>{u(e=>{e.addOption(y())})},N=g(C)&&i;return t.jsx("div",{className:`PollNode__container ${N?"focused":""}`,ref:d,children:t.jsxs("div",{className:"PollNode__inner",children:[t.jsx("h2",{className:"PollNode__heading",children:s}),a.map((e,l)=>{const c=e.uid;return t.jsx(B,{withPollNode:u,option:e,index:l,options:a,totalVotes:x},c)}),t.jsx("div",{className:"PollNode__footer",children:t.jsx(V,{onClick:n,small:!0,children:"Add Option"})})]})})}export{W as default};
