import{r as a,u as W,m as X,o as Y,n as x,p as h,f as P,q as _,s as A,t as Z,b as K,a as ee,k as i,S as te,C as se,N as ne,O as re,l as ae,e as oe,v as le,w as ie,j as t,x as ue,y as ce,L as de,z as me,A as fe,D as ge,_ as xe,F as Ce,G as je,H as pe,I as Ee,P as he,J as Se,T as be,Q as ve}from"./main-DGCghGMi.js";import{p as Re}from"./LexicalNestedComposer.prod-LIkWPcLW.js";import{I as Ie}from"./ImageResizer-C5BjHlz8.js";const H=new Set,T=ve();function Ne(u){if(!H.has(u))throw new Promise(m=>{const o=new Image;o.src=u,o.onload=()=>{H.add(u),m(null)}})}function ke({altText:u,className:m,imageRef:o,src:C,width:S,height:j,maxWidth:b}){return Ne(C),t.jsx("img",{className:m||void 0,src:C,alt:u,ref:o,style:{height:j,maxWidth:b,width:S},draggable:"false"})}function Le({src:u,altText:m,nodeKey:o,width:C,height:S,maxWidth:j,resizable:b,showCaption:p,caption:c,captionsEnabled:$}){const E=a.useRef(null),v=a.useRef(null),[l,d,R]=W(o),[f,L]=a.useState(!1),{isCollabActive:F}=X(),[s]=Y(),[I,G]=a.useState(null),z=a.useRef(null),N=a.useCallback(n=>{if(l&&x(h())){n.preventDefault();const r=P(o);if(_(r))return r.remove(),!0}return!1},[l,o]),D=a.useCallback(n=>{const e=h(),r=v.current;if(l&&x(e)&&e.getNodes().length===1){if(p)return A(null),n.preventDefault(),c.focus(),!0;if(r!==null&&r!==document.activeElement)return n.preventDefault(),r.focus(),!0}return!1},[c,l,p]),y=a.useCallback(n=>z.current===c||v.current===n.target?(A(null),s.update(()=>{d(!0);const e=s.getRootElement();e!==null&&e.focus()}),!0):!1,[c,s,d]),k=a.useCallback(n=>{const e=n;return f?!0:e.target===E.current?(e.shiftKey?d(!l):(R(),d(!0)),!0):!1},[f,l,d,R]),w=a.useCallback(n=>{s.getEditorState().read(()=>{const e=h();n.target.tagName==="IMG"&&Z(e)&&e.getNodes().length===1&&s.dispatchCommand(T,n)})},[s]);a.useEffect(()=>{let n=!0;const e=s.getRootElement(),r=K(s.registerUpdateListener(({editorState:g})=>{n&&G(g.read(()=>h()))}),s.registerCommand(oe,(g,U)=>(z.current=U,!1),i),s.registerCommand(ae,k,i),s.registerCommand(T,k,i),s.registerCommand(re,g=>g.target===E.current?(g.preventDefault(),!0):!1,i),s.registerCommand(ne,N,i),s.registerCommand(se,N,i),s.registerCommand(te,D,i),s.registerCommand(ee,y,i));return e==null||e.addEventListener("contextmenu",w),()=>{n=!1,r(),e==null||e.removeEventListener("contextmenu",w)}},[R,s,f,l,o,N,D,y,k,w,d]);const B=()=>{s.update(()=>{const n=P(o);_(n)&&n.setShowCaption(!0)})},O=(n,e)=>{setTimeout(()=>{L(!1)},200),s.update(()=>{const r=P(o);_(r)&&r.setWidthAndHeight(n,e)})},V=()=>{L(!0)},{historyState:q}=le(),{settings:{showNestedEditorTreeView:J}}=ie(),Q=l&&x(I)&&!f,M=l||f;return t.jsx(a.Suspense,{fallback:null,children:t.jsxs(t.Fragment,{children:[t.jsx("div",{draggable:Q,children:t.jsx(ke,{className:M?`focused ${x(I)?"draggable":""}`:null,src:u,altText:m,imageRef:E,width:C,height:S,maxWidth:j})}),p&&t.jsx("div",{className:"image-caption-container",children:t.jsxs(Re,{initialEditor:c,children:[t.jsx(ue,{}),t.jsx(ce,{}),t.jsx(de,{}),t.jsx(me,{}),t.jsx(fe,{}),t.jsx(ge,{}),F?t.jsx(xe,{id:c.getKey(),providerFactory:Ce,shouldBootstrap:!0}):t.jsx(je,{externalHistoryState:q}),t.jsx(pe,{contentEditable:t.jsx(Ee,{className:"ImageNode__contentEditable"}),placeholder:t.jsx(he,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:Se}),J===!0?t.jsx(be,{}):null]})}),b&&x(I)&&M&&t.jsx(Ie,{showCaption:p,setShowCaption:B,editor:s,buttonRef:v,imageRef:E,maxWidth:j,onResizeStart:V,onResizeEnd:O,captionsEnabled:$})]})})}export{T as RIGHT_CLICK_IMAGE_COMMAND,Le as default};
